<!DOCTYPE html>
<html>
<head>
  <title>‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: sans-serif;
      background: #fffbe6;
      color: #aa0000;
      padding: 20px;
      text-align: center;
    }
    button {
      background-color: #ffcc00;
      color: #aa0000;
      padding: 15px 25px;
      font-size: 18px;
      border: none;
      border-radius: 10px;
      margin-top: 20px;
    }
    video, canvas {
      max-width: 100%;
      margin-top: 10px;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <h1>üì∏ ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶õ‡¶¨‡¶ø ‡¶§‡ßÅ‡¶≤‡ßá ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßã</h1>
  <video id="video" autoplay playsinline width="100%"></video><br>
  <button onclick="capture()">‡¶õ‡¶¨‡¶ø ‡¶§‡ßã‡¶≤‡ßã ‡¶ì ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßã</button>
  <canvas id="canvas" style="display:none;"></canvas>
  <div id="message"></div>

  <script src="https://apis.google.com/js/api.js"></script>
  <script>
    const CLIENT_ID = '74262272116-p9ptj5hc2mu89vr27ido643cgiko3lcc.apps.googleusercontent.com';
    const SCOPES = 'https://www.googleapis.com/auth/drive.file';
    const FOLDER_ID = '1RlSZT08HlcklTX81OotSM6s42YuRGF-4';

    function startCamera() {
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
          document.getElementById('video').srcObject = stream;
        })
        .catch(err => {
          alert('‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø: ' + err);
        });
    }

    function capture() {
      const video = document.getElementById('video');
      const canvas = document.getElementById('canvas');
      const context = canvas.getContext('2d');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      context.drawImage(video, 0, 0, canvas.width, canvas.height);
      canvas.toBlob(uploadToDrive, 'image/jpeg');
    }

    function uploadToDrive(blob) {
      const now = new Date();
      const fileName = now.toISOString().replace(/[:.]/g, '-').replace('T', '_').slice(0, 19) + '.jpg';

      gapi.load('client:auth2', () => {
        gapi.auth2.init({ client_id: CLIENT_ID }).then(() => {
          gapi.auth2.getAuthInstance().signIn().then(() => {
            gapi.client.load('drive', 'v3', () => {
              const fileMetadata = {
                name: fileName,
                parents: [FOLDER_ID]
              };

              const accessToken = gapi.auth.getToken().access_token;
              const form = new FormData();
              form.append('metadata', new Blob([JSON.stringify(fileMetadata)], { type: 'application/json' }));
              form.append('file', blob);

              fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                method: 'POST',
                headers: new Headers({ 'Authorization': 'Bearer ' + accessToken }),
                body: form
              }).then(res => res.json())
                .then(val => {
                  document.getElementById('message').innerText = '‚úÖ ‡¶õ‡¶¨‡¶ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!';
                })
                .catch(err => {
                  document.getElementById('message').innerText = '‚ùå ‡¶Ü‡¶™‡¶≤‡ßã‡¶°‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ' + err.message;
                });
            });
          });
        });
      });
    }

    startCamera();
  </script>
</body>
</html>
